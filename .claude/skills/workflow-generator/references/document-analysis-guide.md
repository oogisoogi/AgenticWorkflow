# Document Analysis Guide

사용자가 워크플로우 설명 문서(PDF 등)를 첨부했을 때의 분석 가이드.

## 분석 체크리스트

문서를 읽으면서 다음 항목을 체계적으로 추출:

### 1. 핵심 목적 (Purpose)

```
- 이 워크플로우의 최종 목표는 무엇인가?
- 어떤 문제를 해결하려 하는가?
- 성공 기준은 무엇인가?
```

### 2. 프로세스 단계 (Steps)

```
- 문서에서 명시적으로 언급된 단계들
- 단계 간의 순서와 의존성
- 각 단계의 목적과 산출물
```

**단계 추출 패턴:**
- 숫자 목록 (1, 2, 3...)
- 순서 키워드 ("먼저", "다음으로", "그 후")
- 섹션 헤딩
- 플로우차트/다이어그램

### 3. 입출력 정의 (I/O)

```
- 전체 워크플로우의 입력: 무엇이 트리거인가?
- 전체 워크플로우의 출력: 최종 산출물은?
- 각 단계별 입력/출력: 중간 산출물들
```

### 4. 기술적 요구사항 (Technical)

```
- 필요한 도구/소프트웨어
- 외부 API/서비스 연동
- 데이터 소스 (RSS, DB, API 등)
- 파일 형식 요구사항
- 데이터 볼륨 추정 (처리량이 패턴 선택에 영향)
- 병렬 처리 필요 여부 (Agent Team 판단 근거)
```

**데이터 볼륨 → 패턴 선택 가이드:**

| 데이터 규모 | 권장 패턴 | 근거 |
|-----------|----------|------|
| 소규모 (단일 문서/API) | Sub-agent 순차 | 단일 전문가의 맥락 유지가 효율적 |
| 중규모 (복수 소스, 독립적) | Agent Team 병렬 | 독립 소스별 전문 에이전트가 품질↑ |
| 대규모 (100+ 항목) | Pre-processing + Agent | P1 원칙: 코드로 정제 후 AI가 판단 |

> **품질 기준 (절대 기준 1)**: "데이터가 많으니까" Agent Team을 쓰는 것이 아니라, "각 소스를 독립 전문가가 깊이 처리해야 품질이 높아지는가"로 판단한다.

### 5. 제약 조건 및 품질 기준 (Constraints & Quality Criteria)

```
- 품질 기준/표준
- 시간 제한/SLA
- 의존성/선행 조건
- 예외 처리 규칙
```

**품질 기준 추출 가이드:**

문서에서 품질 관련 언급을 체계적으로 추출한다. 추출된 기준은 Hook 기반 자동 검증 또는 (human) 검토 단계의 판단 근거가 된다.

| 품질 유형 | 추출 대상 | Claude Code 매핑 |
|----------|----------|-----------------|
| 정량적 기준 | "정확도 95% 이상", "최소 10개 출처" | Hook (command 타입) — 코드로 검증 가능 |
| 정성적 기준 | "전문적 어조", "논리적 흐름" | Hook (prompt/agent 타입) — AI가 평가 |
| 형식 기준 | "마크다운 형식", "3000자 이내" | Hook (command 타입) — 결정론적 검증 |
| 도메인 기준 | "학술 인용 규칙 준수" | Skill 주입 + Hook 검증 |

> **절대 기준 1 적용**: 품질 기준이 명시되지 않은 경우, "최고 수준의 품질"을 기본값으로 사용한다. 품질 기준을 낮추는 방향의 해석은 하지 않는다.

### 6. 휴먼-인-더-루프 (Human Checkpoints)

```
- 명시적 승인/검토 단계
- 의사결정이 필요한 지점
- 품질 검수 단계
- 예외 상황 처리
```

**식별 키워드:**
- "검토", "승인", "확인", "선택"
- "review", "approve", "verify", "select"
- "담당자", "관리자", "사람이"

**Claude Code 기능 매핑:**

| 개입 유형 | Claude Code 기능 | 워크플로우 표기 |
|----------|-----------------|---------------|
| 산출물 검토/승인 | Slash Command (`/review-*`) | `(human) 검토 및 승인` |
| 옵션 선택 (사전 정의된 목록) | Slash Command (`/select-*`) | `(human) 옵션 선택` |
| 요구사항 수집 (동적 질문) | AskUserQuestion | 워크플로우 단계 내 호출 |
| 자동 품질 검증 (사람 개입 불필요) | Hook (TaskCompleted, exit 2) | `(hook) 자동 품질 검증` |
| 에스컬레이션 (자동 실패 후) | AskUserQuestion | Orchestrator 에스컬레이션 |

> **판단 기준**: "이 개입이 사전 정의 가능한가?" → Slash Command. "동적으로 질문해야 하는가?" → AskUserQuestion. "결정론적 검증이 가능한가?" → Hook.

## 3단계 구조 매핑

문서 내용을 Research → Planning → Implementation에 배치:

| Phase | 해당하는 활동 유형 |
|-------|------------------|
| **Research** | 정보 수집, 데이터 수집, 소스 탐색, 현황 파악 |
| **Planning** | 분석, 구조화, 설계, 초안 작성, 계획 수립 |
| **Implementation** | 실행, 생성, 배포, 최종본 작성 |

## 불명확한 부분 처리

문서에서 명확하지 않은 부분 기록:

```markdown
**확인 필요 사항:**
1. [단계 X]의 구체적인 실행 방법이 불명확
2. [입력 Y]의 소스/형식이 미정
3. [산출물 Z]의 품질 기준 미명시
4. 휴먼-인-더-루프 지점 추가 필요 여부
```

## 분석 결과 출력 형식

```markdown
## 📋 문서 분석 결과

### 워크플로우 개요
- **목적**: [한 줄 요약]
- **입력**: [트리거/소스]
- **출력**: [최종 산출물]

### 파악된 단계 (총 N개)

**Research Phase**
1. [단계명]: [설명] → 산출물: [파일명]
2. ...

**Planning Phase**
3. [단계명]: [설명] → 산출물: [파일명]
4. ...

**Implementation Phase**
5. [단계명]: [설명] → 산출물: [파일명]

### 휴먼-인-더-루프 지점
- 단계 [N] 후: [검토 내용]
- 단계 [M] 후: [승인 내용]

### 기술적 구현 방향

| 구성요소 | 내용 | 선택 근거 |
|---------|------|----------|
| Sub-agents | [에이전트 목록 + 각 에이전트의 역할·모델·도구] | [왜 이 작업에 Sub-agent가 적합한가] |
| Agent Team | [팀 구성 + 병렬 구조 + Join 조건] | [왜 병렬 처리가 품질을 높이는가] |
| Hooks | [이벤트 + 타입 + 검증 내용] | [왜 자동 검증이 필요한가] |
| Slash Commands | [명령어 + 용도 + 파라미터] | [어떤 사용자 판단이 필요한가] |
| AskUserQuestion | [동적 질문이 필요한 단계] | [왜 사전 정의된 Command로 부족한가] |
| Task Management | [Task 구조 + 의존성] | [Agent Team 사용 시 필수] |
| Skills | [필요 스킬 목록] | [어떤 도메인 지식이 필요한가] |
| MCP Servers | [외부 연동 서비스] | [어떤 외부 데이터/기능이 필요한가] |
| Pre/Post-processing | [전처리/후처리 스크립트] | [P1 원칙: 코드가 정제, AI가 판단] |
| Translation | [텍스트 산출물: `@translator` / 코드·데이터: `none`] | [English-First 실행 — AGENTS.md §5.2] |

> **참조**: 각 구성요소의 상세 구현 패턴은 `references/claude-code-patterns.md`를 참조한다.

### ❓ 확인이 필요한 사항
1. [질문1]
2. [질문2]

---
위 내용이 맞는지 확인해주세요. 수정/추가할 부분이 있으면 말씀해주세요.
```

## 확인 대화 가이드

분석 결과 공유 후 짧고 핵심적인 질문:

**필수 확인:**
- "제가 파악한 단계 구성이 맞나요?"
- "휴먼-인-더-루프 지점이 이것으로 충분한가요?"

**선택적 확인 (불명확한 부분이 있을 때만):**
- "[특정 단계]의 구체적인 방법을 설명해주시겠어요?"
- "[특정 입력]은 어디서 가져오나요?"

**과도한 질문 지양:**
- 문서에서 이미 명확한 내용은 재확인하지 않음
- 한 번에 3개 이상의 질문을 하지 않음

> **P4 규칙 (SKILL.md §설계 원칙 P4)**: 최대 4개 질문, 각 질문에 3개 정도 선택지. AskUserQuestion 도구 사용 시에도 동일 규칙 적용.

## 절대 기준 준수 체크리스트

문서 분석 완료 후, 다음을 확인한다:

- [ ] **절대 기준 1 (품질)**: 워크플로우 단계 수가 품질을 위해 충분한가? 불필요한 단축은 없는가?
- [ ] **절대 기준 2 (SOT)**: 공유 상태가 단일 파일로 관리되는가? 쓰기 권한이 단일 지점인가?
- [ ] **절대 기준 3 (CCP)**: 구현 시 Hook/Agent/MCP 변경의 파급 효과를 분석했는가?

> **참조**: 절대 기준 상세는 `AGENTS.md §2 절대 기준`에 정의되어 있다.
