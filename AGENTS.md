# AgenticWorkflow — AI 에이전트 공통 지시서

> 이 파일은 **모델·도구에 무관하게** 이 프로젝트에서 작업하는 모든 AI 에이전트가 따라야 할 규칙이다.
> Claude Code, Cursor, Copilot, Codex, Windsurf 등 어떤 도구를 사용하든 이 문서의 규칙이 적용된다.

---

## 1. 프로젝트 정의

에이전트 기반 워크플로우 자동화 프로젝트. 복잡한 작업을 체계적 워크플로우로 설계하고, 그 워크플로우를 실제로 구현하여 동작시키는 것이 목적이다.

### 최종 목표 — 2단계 프로세스

| 단계 | 산출물 | 성격 |
|------|--------|------|
| **Phase 1: 워크플로우 설계** | `workflow.md` | 중간 산출물 (설계도) |
| **Phase 2: 워크플로우 구현** | 에이전트·스크립트·자동화가 실제 동작하는 시스템 | **최종 산출물** |

> `workflow.md`를 만드는 것은 절반이다. **그 안에 기술된 내용이 실제로 동작하는 것**이 최종 목표다.

### 워크플로우 기본 구조

모든 워크플로우는 3단계로 구성된다:

1. **Research** — 정보 수집 및 분석
2. **Planning** — 계획 수립, 구조화, 사람의 검토/승인
3. **Implementation** — 실제 실행 및 산출물 생성

각 단계에는 다음을 명시한다:
- 수행 작업 (Task)
- 담당 에이전트
- 데이터 전처리/후처리
- 산출물 (Output)
- 사람 개입 지점 (해당 시)

---

## 2. 절대 기준

> **이 프로젝트의 모든 설계·구현·수정 의사결정에 적용되는 최상위 규칙이다.**
> 아래의 모든 원칙, 가이드라인, 관례보다 상위에 있다.
> 어떤 원칙이든 절대 기준과 충돌하면, 절대 기준이 이긴다.

### 절대 기준 1: 최종 결과물의 품질

> **속도, 토큰 비용, 작업량, 분량 제한은 완전히 무시한다.**
> 모든 의사결정의 유일한 기준은 **최종 결과물의 품질**이다.
> 단계를 줄여서 빠르게 만드는 것보다, 단계를 늘려서라도 품질을 높이는 방향을 선택한다.

적용 예시:
- 워크플로우 단계가 많아져도 품질이 높아지면 → 단계 추가
- 에이전트를 더 써야 품질이 올라가면 → 에이전트 추가
- 검증 단계가 반복되어도 결과물이 나아지면 → 반복 허용

### 절대 기준 2: 단일 파일 SOT + 계층적 메모리 구조

> **단일 파일 SOT(Single Source of Truth) + 계층적 메모리 구조 설계 아래서, 수십 개의 에이전트가 동시에 작동해도 데이터 불일치가 발생하지 않는다.**

설계 규칙:
- **상태 집중**: 워크플로우의 모든 공유 상태는 **단일 파일**(예: `state.json`, `state.yaml`)에 집중한다. 여러 파일에 상태를 분산시키지 않는다.
- **단일 쓰기 지점**: SOT 파일에 대한 쓰기 권한은 Orchestrator(또는 지정된 단일 에이전트)만 갖는다. 다른 에이전트는 읽기 전용으로 접근하고, 자신의 결과를 별도 산출물 파일로 생성한다.
- **충돌 방지**: 복수 에이전트가 동일 파일을 동시에 수정하는 구조를 설계하지 않는다.

```
Bad:  Agent A → state.json 직접 수정
      Agent B → state.json 직접 수정  → 데이터 충돌

Good: Agent A → output-a.md 생성 → Orchestrator에 보고
      Agent B → output-b.md 생성 → Orchestrator에 보고
      Orchestrator → state.json에 병합  → 단일 쓰기 지점
```

### 절대 기준 간 우선순위

> **절대 기준 1(품질)과 절대 기준 2(SOT)가 충돌할 경우, 절대 기준 1이 우선한다.**
> SOT는 품질을 보장하기 위한 **수단**이지, 품질을 제약하는 **목적**이 아니다.

충돌 시나리오와 해소:
- SOT 단일 쓰기 지점이 정보 병목을 일으켜 에이전트가 오래된 데이터로 작업 → **에이전트 간 산출물 직접 참조 허용** (SOT 구조 조정)
- 품질 향상을 위한 단계 추가로 SOT 상태 복잡도 증가 → **감수** (절대 기준 1 > 2)
- 완전 독립 병렬 작업(에이전트 간 공유 상태 없음)에서 SOT가 불필요 → **SOT 경량화 허용** (판단 근거 문서화)

---

## 3. 설계 원칙

절대 기준에 종속되는 하위 원칙이다.

### P1. 정확도를 위한 데이터 정제

큰 데이터를 AI에게 그대로 전달하면 노이즈로 정확도가 하락한다.

- 각 단계에 **전처리(pre-processing)** 명시: 에이전트에게 넘기기 전 노이즈 제거
- 각 단계에 **후처리(post-processing)** 명시: 산출물을 다음 단계에 전달하기 전 정제
- 코드로 사전 계산 가능한 연관관계는 미리 처리 → AI가 판단·분석에 집중

```
Bad:  "수집된 전체 웹페이지 HTML을 에이전트에 전달"
Good: "Python script로 본문만 추출 → 핵심 텍스트만 에이전트에 전달"
```

### P2. 전문성 기반 위임 구조

각 작업을 가장 잘 수행할 수 있는 전문 에이전트에게 위임하여 품질을 극대화한다. Orchestrator는 전체 품질을 조율하고, 전문 에이전트는 각자의 영역에 깊이 집중한다.

```
Orchestrator (품질 조율 + 흐름 관리)
  ├→ Agent A: 전문 리서치 (해당 도메인 최적화)
  ├→ Agent B: 심층 분석 (분석에만 집중)
  └→ Agent C: 검증 및 품질 게이트
```

### P3. 리소스 정확성

이미지, 파일, 외부 리소스가 필요한 단계에서는 정확한 경로를 명시한다. placeholder 누락 불가.

### P4. 질문 설계 규칙

사용자에게 질문할 때:
- 최대 4개까지만
- 각 질문에 3개 정도의 선택지 제공
- 모호한 부분이 없으면 질문 없이 진행

---

## 4. 프로젝트 구조

```
AgenticWorkflow/
├── CLAUDE.md          ← Claude Code 전용 지시서
├── AGENTS.md          ← 이 파일 (모델 무관 공통 지시서)
├── README.md          ← 프로젝트 소개
├── AGENTICWORKFLOW-USER-MANUAL.md              ← 사용자 매뉴얼
├── AGENTICWORKFLOW-ARCHITECTURE-AND-PHILOSOPHY.md  ← 설계 철학 및 아키텍처 전체 조감도
├── .claude/
│   └── skills/
│       ├── workflow-generator/   ← 워크플로우 설계·생성
│       │   ├── SKILL.md          (스킬 정의 + 절대 기준)
│       │   └── references/       (구현 패턴, 템플릿, 문서 분석 가이드)
│       └── doctoral-writing/     ← 박사급 학술 글쓰기
│           ├── SKILL.md          (스킬 정의 + 절대 기준)
│           └── references/       (체크리스트, 빈출 오류, 수정 사례, 분야별 가이드)
├── prompt/              ← 프롬프트 자료
│   ├── crystalize-prompt.md      (프롬프트 압축 기법)
│   ├── distill-partner.md        (에센스 추출 및 최적화)
│   └── crawling-skill-sample.md  (크롤링 스킬 샘플)
└── coding-resource/     ← 참고 자료
```

---

## 5. 구현 요소 매핑

워크플로우 설계 시 아래 구현 요소를 조합한다. 도구마다 명칭이 다르지만 개념은 동일하다.

| 워크플로우 요소 | 개념 | 선택 기준 |
|---------------|------|----------|
| **전문 에이전트** | 특정 영역에 집중하는 단일 에이전트 | 깊은 맥락 유지가 품질의 핵심일 때 |
| **에이전트 그룹** | 복수 에이전트가 병렬로 독립 작업 | 다관점 분석·교차 검증이 품질을 높일 때 |
| **사람 개입 지점** | 검토/승인/선택 등 사용자 인터랙션 | 자동화할 수 없는 판단이 필요할 때 |
| **자동 검증** | 품질 게이트, 포맷 검사, 보안 체크 | 반복적 검증을 자동화할 때 |
| **재사용 모듈** | 도메인 지식, 반복 패턴을 캡슐화 | 검증된 패턴을 일관되게 적용할 때 |
| **외부 연동** | API, DB, 외부 서비스 통합 | 외부 데이터/기능이 필요할 때 |

> **에이전트 선택의 유일한 기준은 "어떤 구조가 최종 결과물의 품질을 가장 높이는가"이다.**
> 병렬 처리가 빠르다는 이유로 에이전트 그룹을 선택하지 않는다.
> 토큰을 적게 쓴다는 이유로 단일 에이전트를 선택하지 않는다.

---

## 6. 스킬 체계

### workflow-generator

워크플로우 정의 파일(`workflow.md`)을 설계·생성하는 스킬.

- **트리거**: "워크플로우 만들어줘", "자동화 파이프라인 설계", "작업 흐름 정의"
- **진입점**: `.claude/skills/workflow-generator/SKILL.md`
- **두 가지 케이스**: (1) 아이디어만 있는 경우 → 대화형 질문, (2) 설명 문서가 있는 경우 → 문서 분석 우선

### doctoral-writing

박사급 학위 논문의 학문적 엄밀성과 명료성을 갖춘 글쓰기 스킬.

- **트리거**: "논문 스타일로 써줘", "학술적 글쓰기", "논문 문장 다듬기"
- **진입점**: `.claude/skills/doctoral-writing/SKILL.md`
- **핵심 원칙**: 명료성, 간결성, 학술적 엄밀성, 논리적 흐름

---

## 7. 스킬 개발 규칙

새로운 스킬을 만들거나 기존 스킬을 수정할 때:

1. **절대 기준 3개를 반드시 포함** — 해당 도메인에 맞게 맥락화하여 적용
2. **파일 간 역할 분담** — 스킬 정의(WHY), 참조 자료(WHAT/HOW/VERIFY)
3. **절대 기준 간 충돌 시나리오를 구체적으로 명시** — 추상적 규칙이 아닌 실전 판단 기준
4. **수정 후 반드시 성찰** — 문구만 넣지 않고, 기존 내용과 충돌 여부를 점검

---

## 8. 언어 및 스타일

- **콘텐츠 언어**: 한국어
- **기술 용어**: 영어 유지 (SOT, Agent, Orchestrator, Hooks 등)
- **시각화**: Mermaid 다이어그램 선호
- **서술 깊이**: 간략 요약보다 포괄적·데이터 기반 서술 선호
- **코드 주석**: 한국어

---

## 9. CLAUDE.md와의 관계

| 파일 | 대상 | 역할 |
|------|------|------|
| `AGENTS.md` | 모든 AI 에이전트 (모델·도구 무관) | 프로젝트의 목적, 절대 기준, 설계 원칙, 구조를 모델 무관하게 정의 |
| `CLAUDE.md` | Claude Code 전용 | Claude Code의 고유 기능(Sub-agents, Agent Teams, Hooks, Skills, MCP)에 맞춘 구체적 구현 매핑 |

> 두 파일의 절대 기준과 설계 원칙은 **동일**하다. 차이는 구현 매핑의 구체성뿐이다.
> 충돌 시 AGENTS.md의 절대 기준이 우선한다 (도구 종속적 구현보다 원칙이 상위).
